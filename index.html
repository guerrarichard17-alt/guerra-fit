<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Guerra Fit Coach ‚Äì Pro V4</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />

  <style>
    /* --- DESIGN SYSTEM (Cyberpunk Clean) --- */
    :root {
      --bg-app: #09090b;       /* Fundo Principal */
      --bg-card: #18181b;      /* Fundo Cards */
      --bg-input: #27272a;     /* Fundo Inputs */
      --border: #3f3f46;       /* Bordas */
      
      --text-main: #f4f4f5;
      --text-muted: #a1a1aa;
      
      --primary: #22c55e;      /* Verde (Conclus√£o/Cardio) */
      --primary-glow: rgba(34, 197, 94, 0.25);
      
      --accent-strength: #ef4444; /* Vermelho (For√ßa) */
      --accent-warmup: #3b82f6;   /* Azul (Aquecimento) */
      
      --radius: 12px;
      --font-stack: 'Inter', system-ui, -apple-system, sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      background: var(--bg-app);
      color: var(--text-main);
      font-family: var(--font-stack);
      font-size: 14px;
      padding-bottom: 80px;
    }

    /* --- HEADER & PROGRESSO --- */
    header {
      background: rgba(9, 9, 11, 0.95);
      border-bottom: 1px solid var(--border);
      padding: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(8px);
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: -0.5px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    header small {
      color: var(--text-muted);
      font-size: 11px;
      display: block;
      margin-top: 4px;
    }

    .progress-container {
      margin-top: 12px;
      background: var(--bg-input);
      height: 6px;
      border-radius: 99px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      width: 0%;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 8px var(--primary-glow);
    }
    .progress-label {
      font-size: 10px;
      color: var(--text-muted);
      text-align: right;
      margin-top: 4px;
    }

    main {
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* --- TABS --- */
    .main-tabs {
      display: flex;
      background: var(--bg-input);
      padding: 4px;
      border-radius: 10px;
      margin-bottom: 20px;
      position: sticky;
      top: 85px;
      z-index: 90;
    }
    .main-tabs button {
      flex: 1;
      background: transparent;
      border: none;
      padding: 10px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }
    .main-tabs button.active {
      background: var(--bg-card);
      color: var(--text-main);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      border: 1px solid var(--border);
    }

    .sub-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .sub-tabs button {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      white-space: nowrap;
      cursor: pointer;
    }
    .sub-tabs button.active {
      background: var(--primary);
      color: #000;
      border-color: var(--primary);
      font-weight: bold;
    }

    /* --- CARDS --- */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
    }

    /* --- EXERCISE ITEM --- */
    .exercise-card {
      background: var(--bg-card);
      border-left: 4px solid var(--border);
      padding: 14px;
      margin-bottom: 12px;
      border-radius: 8px;
      position: relative;
      transition: transform 0.1s;
    }
    .exercise-card:active { transform: scale(0.99); }

    .type-strength { border-left-color: var(--accent-strength); }
    .type-warmup { 
      border-left-color: var(--accent-warmup); 
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.05) 0%, var(--bg-card) 100%);
    }
    .type-cardio { border-left-color: var(--primary); }

    .ex-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    .ex-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-main);
      line-height: 1.3;
    }
    .ex-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .badge {
      background: var(--bg-input);
      border: 1px solid var(--border);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
      white-space: nowrap;
      margin-left: 8px;
    }
    .badge-warmup { color: var(--accent-warmup); border-color: var(--accent-warmup); }

    .ex-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
    }
    .input-wrapper label {
      display: block;
      font-size: 10px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 3px;
    }
    input, textarea, select {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      color: var(--text-main);
      border-radius: 6px;
      padding: 10px;
      font-size: 14px;
      font-family: inherit;
    }
    input:focus { outline: 1px solid var(--primary); border-color: var(--primary); }

    .ex-footer {
      border-top: 1px solid var(--border);
      padding-top: 10px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .check-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      width: 100%;
    }
    .check-box {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    input[type="checkbox"]:checked + .check-box {
      background: var(--primary);
      border-color: var(--primary);
    }
    input[type="checkbox"]:checked + .check-box::after {
      content: '‚úî';
      color: #000;
      font-size: 14px;
      font-weight: 800;
    }
    .check-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }
    input[type="checkbox"]:checked ~ .check-text {
      color: var(--primary);
    }

    /* --- SHOPPING LIST --- */
    .shop-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--bg-input);
      cursor: pointer;
    }
    .shop-item.done .shop-name {
      text-decoration: line-through;
      color: var(--text-muted);
      opacity: 0.5;
    }
    .shop-item.done .shop-qty {
      opacity: 0.5;
    }

    /* UTILS */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    
    footer {
      margin-top: 40px;
      padding: 20px;
      text-align: center;
      color: #3f3f46;
      font-size: 10px;
      border-top: 1px solid var(--bg-input);
    }
  </style>
</head>

<body>

  <header>
    <h1>
      <span style="font-size:24px;">üß¨</span> 
      GUERRA FIT <span style="color:var(--primary); font-size:12px; margin-left:4px;">PRO V4</span>
    </h1>
    <small>93kg | 1,87m | Hipertrofia & Praticidade</small>

    <div id="progressArea" class="hidden">
      <div class="progress-container">
        <div id="progressBar" class="progress-fill"></div>
      </div>
      <div id="progressLabel" class="progress-label">0% Conclu√≠do</div>
    </div>
  </header>

  <main>
    <nav class="main-tabs">
      <button class="active" onclick="setTab('treino')" id="btn-treino">üèãÔ∏è TREINO</button>
      <button onclick="setTab('dieta')" id="btn-dieta">ü•ó DIETA</button>
    </nav>

    <section id="view-treino">
      <div class="card">
        <div class="ex-grid">
          <div class="input-wrapper">
            <label>Dia do Treino</label>
            <select id="diaSelect" onchange="renderTreino()"></select>
          </div>
          <div class="input-wrapper">
            <label>Data</label>
            <input type="date" id="dataInput" onchange="renderTreino()">
          </div>
        </div>
        <div style="font-size:11px; color:var(--text-muted); text-align:center;">
          Os dados s√£o salvos automaticamente.
        </div>
      </div>

      <div class="sub-tabs">
        <button class="active" onclick="filterTreino('todo')" id="sub-treino-todo">Todo</button>
        <button onclick="filterTreino('warmup')" id="sub-treino-warmup">Aquecimento</button>
      </div>

      <div id="treinoContainer"></div>
    </section>

    <section id="view-dieta" class="hidden">
      <div class="card" style="padding:10px;">
         <h4 style="margin:0 0 5px 0; color:var(--primary)">Estrat√©gia Meal Prep</h4>
         <p style="margin:0; font-size:11px; color:var(--text-muted)">
           Marmitas de Seg √† Sex. Fim de semana ajustado.
         </p>
      </div>

      <div class="sub-tabs">
        <button class="active" onclick="renderDieta('hoje')" id="sub-dieta-hoje">Hoje</button>
        <button onclick="renderDieta('semana')" id="sub-dieta-semana">Semana</button>
        <button onclick="renderDieta('compras')" id="sub-dieta-compras">Lista de Compras</button>
      </div>

      <div id="dietaContainer"></div>
    </section>
  </main>

  <footer>
    <strong>DEV FIT COACH</strong><br>
    Const√¢ncia √© o segredo da hipertrofia.
  </footer>

  <script>
    // =================================================================
    // 1. BANCO DE DADOS: TREINOS (V3.0 Validada)
    // =================================================================
    const DEFAULT_TREINOS = [
      // --- SEGUNDA: PUSH ---
      { dia: "Segunda", grupo: "Aquecimento", exercicio: "Manguito + Rota√ß√£o", series: "2", reps: "15", tipo: "Aquecimento", obs: "Prepare os ombros." },
      { dia: "Segunda", grupo: "Peito", exercicio: "Supino Inclinado (Halter)", series: "4", reps: "8-10", tipo: "For√ßa", obs: "Banco 30¬∫. Foco clavicular." },
      { dia: "Segunda", grupo: "Peito", exercicio: "Supino Reto M√°quina/Barra", series: "3", reps: "10-12", tipo: "Hipertrofia", obs: "Carga controlada." },
      { dia: "Segunda", grupo: "Ombro", exercicio: "Eleva√ß√£o Lateral", series: "4", reps: "15", tipo: "Metab√≥lico", obs: "At√© a falha." },
      { dia: "Segunda", grupo: "Tr√≠ceps", exercicio: "Tr√≠ceps Corda/Polia", series: "4", reps: "10-12", tipo: "Hipertrofia", obs: "Extens√£o total." },

      // --- TER√áA: PULL ---
      { dia: "Ter√ßa", grupo: "Aquecimento", exercicio: "Retra√ß√£o Escapular", series: "2", reps: "15", tipo: "Aquecimento", obs: "Ative as costas." },
      { dia: "Ter√ßa", grupo: "Costas", exercicio: "Levantamento Terra (Rack Pull)", series: "3", reps: "5-6", tipo: "For√ßa", obs: "Carga pesada." },
      { dia: "Ter√ßa", grupo: "Costas", exercicio: "Puxada Alta (Aberta)", series: "4", reps: "8-10", tipo: "Hipertrofia", obs: "Amplitude m√°xima." },
      { dia: "Ter√ßa", grupo: "Costas", exercicio: "Remada Curvada", series: "3", reps: "12", tipo: "Hipertrofia", obs: "Tronco est√°vel." },
      { dia: "Ter√ßa", grupo: "B√≠ceps", exercicio: "Rosca Direta", series: "4", reps: "8-12", tipo: "Hipertrofia", obs: "Sem roubar." },

      // --- QUARTA: LEGS 1 ---
      { dia: "Quarta", grupo: "Aquecimento", exercicio: "Mobilidade de Quadril", series: "2", reps: "15", tipo: "Aquecimento", obs: "Solte o quadril." },
      { dia: "Quarta", grupo: "Quadr√≠ceps", exercicio: "Agachamento Livre", series: "4", reps: "6-8", tipo: "For√ßa", obs: "Amplitude m√°xima." },
      { dia: "Quarta", grupo: "Quadr√≠ceps", exercicio: "Leg Press 45", series: "4", reps: "10-12", tipo: "Hipertrofia", obs: "P√©s largura ombros." },
      { dia: "Quarta", grupo: "Quadr√≠ceps", exercicio: "Cadeira Extensora", series: "3", reps: "15", tipo: "Metab√≥lico", obs: "Isometria 1s em cima." },
      { dia: "Quarta", grupo: "Panturrilha", exercicio: "G√™meos Sentado", series: "4", reps: "15-20", tipo: "Resist√™ncia", obs: "Queima√ß√£o total." },

      // --- QUINTA: OFF ---
      { dia: "Quinta", grupo: "Recupera√ß√£o", exercicio: "Alongamento Geral", series: "1", reps: "20 min", tipo: "Aquecimento", obs: "Foco em lombar e pernas." },
      { dia: "Quinta", grupo: "Cardio", exercicio: "Caminhada Leve", series: "1", reps: "40 min", tipo: "Cardio", obs: "Zona 1 apenas." },

      // --- SEXTA: UPPER BODY ---
      { dia: "Sexta", grupo: "Aquecimento", exercicio: "Flex√£o de Bra√ßo", series: "2", reps: "15", tipo: "Aquecimento", obs: "Aquecimento geral." },
      { dia: "Sexta", grupo: "Peito/Costas", exercicio: "Supino Inclinado M√°quina", series: "3", reps: "10-12", tipo: "Hipertrofia", obs: "Foco no peito." },
      { dia: "Sexta", grupo: "Peito/Costas", exercicio: "Puxada Tri√¢ngulo", series: "3", reps: "10-12", tipo: "Hipertrofia", obs: "Foco no miolo costas." },
      { dia: "Sexta", grupo: "Ombros", exercicio: "Desenvolvimento M√°quina", series: "3", reps: "10-12", tipo: "Hipertrofia", obs: "Ombros." },
      { dia: "Sexta", grupo: "Bra√ßos", exercicio: "Rosca Martelo + Tr√≠ceps", series: "3", reps: "12+12", tipo: "Metab√≥lico", obs: "Bi-set." },

      // --- S√ÅBADO: LEGS 2 ---
      { dia: "S√°bado", grupo: "Aquecimento", exercicio: "Eleva√ß√£o P√©lvica (Solo)", series: "2", reps: "20", tipo: "Aquecimento", obs: "Ative gl√∫teos." },
      { dia: "S√°bado", grupo: "Posterior", exercicio: "Stiff", series: "4", reps: "8-10", tipo: "For√ßa", obs: "Alongue bem o posterior." },
      { dia: "S√°bado", grupo: "Posterior", exercicio: "Mesa Flexora", series: "4", reps: "12-15", tipo: "Hipertrofia", obs: "At√© a falha." },
      { dia: "S√°bado", grupo: "Pernas Geral", exercicio: "Afundo/Passada", series: "3", reps: "12 cada", tipo: "Metab√≥lico", obs: "Finalizador." },

      // --- DOMINGO: OFF ---
      { dia: "Domingo", grupo: "Descanso", exercicio: "Descanso Total", series: "-", reps: "-", tipo: "Recupera√ß√£o", obs: "Dia de Meal Prep." }
    ];

    // =================================================================
    // 2. BANCO DE DADOS: DIETA COMPLETA (Seg-Dom)
    // =================================================================
    const DEFAULT_DIETA = [
      // --- SEGUNDA A SEXTA (ROTINA MARMITA) ---
      // Desjejum 04:30
      { dia: "Segunda", refeicao: "1. Pr√©-Treino (04:30)", item: "Overnight Oats (Aveia 60g+Whey+Leite)", qtd: 1, un: "pote", grupo: "Seg-Sex Manh√£" },
      { dia: "Segunda", refeicao: "1. Pr√©-Treino (04:30)", item: "Banana", qtd: 1, un: "un", grupo: "Seg-Sex Manh√£" },
      { dia: "Ter√ßa",   refeicao: "1. Pr√©-Treino (04:30)", item: "Ovos Mexidos (4 ovos)", qtd: 1, un: "prato", grupo: "Seg-Sex Manh√£" },
      { dia: "Ter√ßa",   refeicao: "1. Pr√©-Treino (04:30)", item: "P√£o Integral", qtd: 2, un: "fatias", grupo: "Seg-Sex Manh√£" },
      { dia: "Quarta",  refeicao: "1. Pr√©-Treino (04:30)", item: "Overnight Oats (Aveia 60g+Whey+Leite)", qtd: 1, un: "pote", grupo: "Seg-Sex Manh√£" },
      { dia: "Quinta",  refeicao: "1. Pr√©-Treino (04:30)", item: "Ovos Mexidos (4 ovos)", qtd: 1, un: "prato", grupo: "Seg-Sex Manh√£" },
      { dia: "Quinta",  refeicao: "1. Pr√©-Treino (04:30)", item: "P√£o Integral", qtd: 2, un: "fatias", grupo: "Seg-Sex Manh√£" },
      { dia: "Sexta",   refeicao: "1. Pr√©-Treino (04:30)", item: "Vitamina (Whey+Banana+Aveia 50g)", qtd: 1, un: "copo", grupo: "Seg-Sex Manh√£" },

      // P√≥s-Treino (Trabalho)
      { dia: "Segunda", refeicao: "2. P√≥s-Treino (08:30)", item: "Iogurte Natural + Whey", qtd: 1, un: "dose", grupo: "Seg-Sex P√≥s" },
      { dia: "Ter√ßa",   refeicao: "2. P√≥s-Treino (08:30)", item: "Iogurte Natural + Whey", qtd: 1, un: "dose", grupo: "Seg-Sex P√≥s" },
      { dia: "Quarta",  refeicao: "2. P√≥s-Treino (08:30)", item: "Iogurte Natural + Whey", qtd: 1, un: "dose", grupo: "Seg-Sex P√≥s" },
      { dia: "Quinta",  refeicao: "2. P√≥s-Treino (08:30)", item: "Barra Prote√≠na + Fruta", qtd: 1, un: "kit", grupo: "Seg-Sex P√≥s" },
      { dia: "Sexta",   refeicao: "2. P√≥s-Treino (08:30)", item: "Iogurte Natural + Whey", qtd: 1, un: "dose", grupo: "Seg-Sex P√≥s" },

      // Almo√ßo (Marmitas)
      { dia: "Segunda", refeicao: "3. Almo√ßo (Marmita)", item: "Patinho Mo√≠do", qtd: 200, un: "g", grupo: "Prote√≠na Carne" },
      { dia: "Segunda", refeicao: "3. Almo√ßo (Marmita)", item: "Arroz Branco/Parbolizado", qtd: 280, un: "g", grupo: "Carbo Arroz" },
      { dia: "Ter√ßa",   refeicao: "3. Almo√ßo (Marmita)", item: "Frango Cubos (Molho)", qtd: 200, un: "g", grupo: "Prote√≠na Frango" },
      { dia: "Ter√ßa",   refeicao: "3. Almo√ßo (Marmita)", item: "Pur√™ Batata/Mandioca", qtd: 280, un: "g", grupo: "Carbo Pur√™" },
      { dia: "Quarta",  refeicao: "3. Almo√ßo (Marmita)", item: "Patinho Mo√≠do", qtd: 200, un: "g", grupo: "Prote√≠na Carne" },
      { dia: "Quarta",  refeicao: "3. Almo√ßo (Marmita)", item: "Macarr√£o Integral", qtd: 250, un: "g", grupo: "Carbo Massa" },
      { dia: "Quinta",  refeicao: "3. Almo√ßo (Marmita)", item: "Frango Desfiado", qtd: 200, un: "g", grupo: "Prote√≠na Frango" },
      { dia: "Quinta",  refeicao: "3. Almo√ßo (Marmita)", item: "Arroz com Legumes", qtd: 280, un: "g", grupo: "Carbo Arroz" },
      { dia: "Sexta",   refeicao: "3. Almo√ßo (Marmita)", item: "Peixe (Til√°pia) ou Carne", qtd: 200, un: "g", grupo: "Prote√≠na Peixe" },
      { dia: "Sexta",   refeicao: "3. Almo√ßo (Marmita)", item: "Batata Assada/Doce", qtd: 280, un: "g", grupo: "Carbo Batata" },

      // Jantar (Leve)
      { dia: "Segunda", refeicao: "4. Jantar", item: "Omelete (3 ovos + Queijo)", qtd: 1, un: "un", grupo: "Jantar Ovos" },
      { dia: "Ter√ßa",   refeicao: "4. Jantar", item: "Carne Mo√≠da (Marmita)", qtd: 150, un: "g", grupo: "Prote√≠na Carne" },
      { dia: "Quarta",  refeicao: "4. Jantar", item: "Frango Cubos + Salada", qtd: 150, un: "g", grupo: "Prote√≠na Frango" },
      { dia: "Quinta",  refeicao: "4. Jantar", item: "Ovos Cozidos (4 un)", qtd: 4, un: "un", grupo: "Jantar Ovos" },
      { dia: "Sexta",   refeicao: "4. Jantar", item: "Wrap (Rap10 Integral + Frango)", qtd: 2, un: "un", grupo: "Jantar Especial" },

      // --- S√ÅBADO (DIA DE TREINO DE PERNA - HIGH CARB) ---
      { dia: "S√°bado", refeicao: "1. Pr√©-Treino", item: "P√£o Franc√™s + Ovos Mexidos (3)", qtd: 1, un: "un", grupo: "FDS Caf√©" },
      { dia: "S√°bado", refeicao: "1. Pr√©-Treino", item: "Mam√£o + Aveia", qtd: 1, un: "fatia", grupo: "FDS Caf√©" },
      { dia: "S√°bado", refeicao: "2. Almo√ßo (Livre)", item: "Feijoada Light ou Churrasco", qtd: 1, un: "prato", grupo: "FDS Almo√ßo" },
      { dia: "S√°bado", refeicao: "2. Almo√ßo (Livre)", item: "Arroz Branco + Vinagrete", qtd: 1, un: "prato", grupo: "FDS Almo√ßo" },
      { dia: "S√°bado", refeicao: "3. Lanche", item: "Iogurte + Fruta", qtd: 1, un: "pote", grupo: "FDS Lanche" },
      { dia: "S√°bado", refeicao: "4. Jantar (Social)", item: "Hamb√∫rguer Caseiro (Patinho)", qtd: 2, un: "un", grupo: "FDS Jantar" },

      // --- DOMINGO (DESCANSO - RECOVERY/LOW CARB) ---
      { dia: "Domingo", refeicao: "1. Caf√© Tardio", item: "Crepioca (2 ovos + 2 col goma)", qtd: 1, un: "un", grupo: "FDS Caf√©" },
      { dia: "Domingo", refeicao: "1. Caf√© Tardio", item: "Caf√© Preto + Fruta", qtd: 1, un: "dose", grupo: "FDS Caf√©" },
      { dia: "Domingo", refeicao: "2. Almo√ßo Fam√≠lia", item: "Assado (Carne ou Frango)", qtd: 250, un: "g", grupo: "FDS Almo√ßo" },
      { dia: "Domingo", refeicao: "2. Almo√ßo Fam√≠lia", item: "Legumes Assados + Salada", qtd: 1, un: "prato", grupo: "FDS Almo√ßo" },
      { dia: "Domingo", refeicao: "3. Lanche Tarde", item: "Whey Protein + √Ågua", qtd: 1, un: "dose", grupo: "Suplemento" },
      { dia: "Domingo", refeicao: "4. Jantar Leve", item: "Sopa de Legumes c/ Frango", qtd: 1, un: "prato", grupo: "FDS Jantar" }
    ];

    // =================================================================
    // 3. APP LOGIC
    // =================================================================
    const STORAGE_KEY = "guerra_fit_logs_v4_final";
    let dailyLog = {};

    function init() {
      // 1. Carrega Logs
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        dailyLog = raw ? JSON.parse(raw) : {};
      } catch { dailyLog = {}; }

      // 2. Data de Hoje
      const hoje = new Date();
      const offset = hoje.getTimezoneOffset() * 60000;
      const localISO = new Date(hoje.getTime() - offset).toISOString().slice(0, 10);
      document.getElementById("dataInput").value = localISO;

      // 3. Preenche Select de Dias
      const diasUnicos = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"];
      const sel = document.getElementById("diaSelect");
      diasUnicos.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        sel.appendChild(opt);
      });

      // 4. Seleciona dia da semana atual
      const diaSemanaMap = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];
      const hojeNome = diaSemanaMap[hoje.getDay()];
      sel.value = hojeNome;

      renderTreino();
    }

    // --- RENDER TREINO ---
    function renderTreino() {
      const container = document.getElementById("treinoContainer");
      container.innerHTML = "";
      
      const diaSel = document.getElementById("diaSelect").value;
      const dataSel = document.getElementById("dataInput").value;
      const filtro = document.querySelector(".sub-tabs button.active").id; 

      // Filtra Exercicios do Dia
      let exercicios = DEFAULT_TREINOS.filter(e => e.dia === diaSel);

      if(exercicios.length === 0) {
        container.innerHTML = `<div class="card text-center" style="color:var(--text-muted)">Sem treinos configurados para ${diaSel}.</div>`;
        document.getElementById("progressArea").classList.add("hidden");
        return;
      }

      document.getElementById("progressArea").classList.remove("hidden");

      exercicios.forEach((ex, idx) => {
        const isWarmup = ex.tipo === "Aquecimento";
        if(filtro === "sub-treino-warmup" && !isWarmup) return;

        const key = `ex_${diaSel}_${idx}::${dataSel}`;
        const log = dailyLog[key] || {};

        let typeClass = "type-strength";
        if(isWarmup) typeClass = "type-warmup";
        if(ex.tipo === "Cardio" || ex.tipo === "Metab√≥lico") typeClass = "type-cardio";

        const div = document.createElement("div");
        div.className = `exercise-card ${typeClass}`;
        div.innerHTML = `
          <div class="ex-header">
            <div>
              <div class="ex-title">${ex.exercicio}</div>
              <div class="ex-subtitle">${ex.grupo} ‚Ä¢ ${ex.tipo}</div>
            </div>
            ${isWarmup ? '<span class="badge badge-warmup">AQUECER</span>' : ''}
          </div>

          <div style="font-size:12px; color:var(--text-main); margin-bottom:8px;">
             <strong>Meta:</strong> ${ex.series} x ${ex.reps} | <em>"${ex.obs}"</em>
          </div>

          <div class="ex-grid">
            <div class="input-wrapper">
              <label>Carga (kg)</label>
              <input type="number" placeholder="Kg" value="${log.carga || ''}" onchange="saveEx('${key}', 'carga', this.value)">
            </div>
            <div class="input-wrapper">
              <label>RPE (1-10)</label>
              <input type="number" placeholder="Intensidade" value="${log.rpe || ''}" onchange="saveEx('${key}', 'rpe', this.value)">
            </div>
          </div>
          
          <div class="ex-footer">
             <label class="check-label">
                <input type="checkbox" class="hidden" ${log.done ? 'checked' : ''} onchange="saveEx('${key}', 'done', this.checked)">
                <div class="check-box"></div>
                <div class="check-text">${log.done ? 'CONCLU√çDO' : 'FINALIZAR EXERC√çCIO'}</div>
             </label>
          </div>
        `;
        container.appendChild(div);
      });

      updateProgress();
    }

    function saveEx(key, field, val) {
      if(!dailyLog[key]) dailyLog[key] = {};
      dailyLog[key][field] = val;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyLog));
      if(field === 'done') renderTreino();
    }

    function updateProgress() {
      const diaSel = document.getElementById("diaSelect").value;
      const dataSel = document.getElementById("dataInput").value;
      const total = DEFAULT_TREINOS.filter(e => e.dia === diaSel).length;
      
      let doneCount = 0;
      DEFAULT_TREINOS.forEach((ex, idx) => {
        if(ex.dia !== diaSel) return;
        const key = `ex_${diaSel}_${idx}::${dataSel}`;
        if(dailyLog[key] && dailyLog[key].done) doneCount++;
      });

      const pct = total === 0 ? 0 : Math.round((doneCount / total) * 100);
      document.getElementById("progressBar").style.width = pct + "%";
      document.getElementById("progressLabel").textContent = `${pct}% Conclu√≠do`;
    }

    // --- RENDER DIETA ---
    function renderDieta(modo) {
      document.querySelectorAll(".sub-tabs button").forEach(b => b.classList.remove("active"));
      if(modo === 'hoje') document.getElementById("sub-dieta-hoje").classList.add("active");
      if(modo === 'semana') document.getElementById("sub-dieta-semana").classList.add("active");
      if(modo === 'compras') document.getElementById("sub-dieta-compras").classList.add("active");

      const container = document.getElementById("dietaContainer");
      container.innerHTML = "";

      // 1. MODO HOJE
      if(modo === 'hoje') {
         const dataInput = document.getElementById("dataInput").value;
         const d = new Date(dataInput);
         const diaSemanaMap = ["Domingo","Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado"];
         const userDia = diaSemanaMap[new Date(d.getTime() + d.getTimezoneOffset()*60000).getDay()];

         const itens = DEFAULT_DIETA.filter(i => i.dia === userDia);
         
         if(itens.length === 0) {
            container.innerHTML = `<div class="card text-center">Sem card√°pio espec√≠fico para ${userDia}.</div>`;
            return;
         }
         
         const refs = [...new Set(itens.map(i => i.refeicao))];
         refs.forEach(refNome => {
            const div = document.createElement("div");
            div.className = "card";
            let html = `<h4 style="margin:0 0 10px 0; color:var(--primary); font-size:14px;">${refNome}</h4>`;
            itens.filter(i => i.refeicao === refNome).forEach(alimento => {
               html += `
                 <div style="display:flex; justify-content:space-between; border-bottom:1px solid var(--bg-input); padding:6px 0;">
                    <span>${alimento.item}</span>
                    <strong style="color:var(--text-main)">${alimento.qtd} ${alimento.un}</strong>
                 </div>
               `;
            });
            div.innerHTML = html;
            container.appendChild(div);
         });
      }

      // 2. MODO SEMANA
      if(modo === 'semana') {
         const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"];
         dias.forEach(dia => {
            const itensDia = DEFAULT_DIETA.filter(i => i.dia === dia);
            // Pega almo√ßo e jantar para resumo
            const almoco = itensDia.find(i => i.refeicao.toLowerCase().includes("almo√ßo"))?.item || "Variado";
            const jantar = itensDia.find(i => i.refeicao.toLowerCase().includes("jantar"))?.item || "Variado";

            const div = document.createElement("div");
            div.className = "card";
            div.innerHTML = `
              <div style="font-weight:bold; color:var(--text-muted); margin-bottom:5px;">${dia}</div>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                 <div><span style="font-size:10px;">‚òÄÔ∏è ALMO√áO</span><br>${almoco}</div>
                 <div><span style="font-size:10px;">üåô JANTAR</span><br>${jantar}</div>
              </div>
            `;
            container.appendChild(div);
         });
      }

      // 3. MODO COMPRAS
      if(modo === 'compras') {
         let lista = {};
         DEFAULT_DIETA.forEach(d => {
            const nome = d.item;
            // Somar apenas se for num√©rico
            if(!lista[nome]) lista[nome] = { qtd: 0, un: d.un, grupo: d.grupo };
            lista[nome].qtd += (typeof d.qtd === 'number' ? d.qtd : 0);
         });

         const div = document.createElement("div");
         div.className = "card";
         div.innerHTML = `<h4 style="margin-top:0;">Lista de Supermercado</h4>`;
         
         Object.keys(lista).sort().forEach((nome, idx) => {
             const it = lista[nome];
             div.innerHTML += `
               <label class="shop-item" onclick="this.classList.toggle('done')">
                  <div style="flex:1">
                     <div class="shop-name" style="font-weight:600">${nome}</div>
                     <div class="shop-qty" style="font-weight:bold; color:var(--primary)">${it.qtd > 0 ? parseFloat(it.qtd.toFixed(1)) : ''} ${it.un}</div>
                  </div>
                  <div style="font-size:20px; color:var(--text-muted)">+</div>
               </label>
             `;
         });
         container.appendChild(div);
      }
    }

    function setTab(tab) {
      document.getElementById("btn-treino").classList.remove("active");
      document.getElementById("btn-dieta").classList.remove("active");
      document.getElementById(`btn-${tab}`).classList.add("active");
      document.getElementById("view-treino").classList.add("hidden");
      document.getElementById("view-dieta").classList.add("hidden");
      document.getElementById(`view-${tab}`).classList.remove("hidden");
    }

    function filterTreino(tipo) {
       document.getElementById("sub-treino-todo").classList.remove("active");
       document.getElementById("sub-treino-warmup").classList.remove("active");
       document.getElementById(`sub-treino-${tipo}`).classList.add("active");
       renderTreino();
    }

    document.addEventListener("DOMContentLoaded", init);

  </script>
</body>
</html>
