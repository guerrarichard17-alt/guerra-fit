
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Guerra Fit – Treinos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="guerra-fit-icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="guerra-fit-icon-192.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <style>
        :root {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color-scheme: light dark;
        }
        body {
            margin: 0;
            background: #020617;
            color: #e5e7eb;
        }
        header {
            padding: 12px 16px 10px;
            background: #020617;
            border-bottom: 1px solid #1f2937;
        }
        header h1 {
            margin: 0;
            font-size: 18px;
        }
        header small {
            color: #9ca3af;
            font-size: 12px;
        }
        main {
            padding: 10px;
            max-width: 900px;
            margin: 0 auto;
        }
        .card {
            background: #020617;
            border-radius: 12px;
            border: 1px solid #1f2937;
            padding: 10px;
            margin-bottom: 10px;
        }
        label {
            font-size: 12px;
            display: block;
            margin-bottom: 2px;
        }
        input[type="file"],
        select,
        input[type="date"] {
            background: #020617;
            border-radius: 8px;
            border: 1px solid #4b5563;
            padding: 8px 10px;
            font-size: 13px;
            color: #e5e7eb;
            width: 100%;
            box-sizing: border-box;
        }
        input[type="file"] {
            padding: 6px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .col-6 {
            flex: 1 1 48%;
            min-width: 150px;
        }
        @media (max-width: 640px) {
            .col-6 {
                flex: 1 1 100%;
            }
        }
        .tabs {
            display: flex;
            gap: 6px;
            margin-top: 4px;
            margin-bottom: 8px;
        }
        .tab-btn {
            flex: 1;
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            font-size: 13px;
            cursor: pointer;
        }
        .tab-btn.active {
            background: #2563eb;
            border-color: #2563eb;
        }
        .status {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 4px;
        }
        .help-text {
            font-size: 11px;
            color: #9ca3af;
        }
        .pill {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 999px;
            background: #0b1120;
            border: 1px solid #374151;
            font-size: 11px;
            gap: 6px;
        }
        .pill-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #22c55e;
        }
        .scroll-box {
            max-height: 60vh;
            overflow: auto;
            border-radius: 12px;
            border: 1px solid #1f2937;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 11px;
            min-width: 600px;
        }
        th, td {
            border: 1px solid #1f2937;
            padding: 4px 6px;
            text-align: left;
        }
        th {
            background: #020617;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:nth-child(even) td {
            background: #020617;
        }
        tr:nth-child(odd) td {
            background: #020617;
        }
        button.link-btn, button.ghost-btn {
            padding: 7px 10px;
            font-size: 12px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            cursor: pointer;
        }
        button.link-btn:hover,
        button.ghost-btn:hover {
            background: #111827;
        }
        button.primary {
            background: #2563eb;
            border-color: #2563eb;
        }
        .week-section-title {
            font-weight: 600;
            font-size: 13px;
            margin-top: 10px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .week-section-title span {
            font-size: 11px;
            color: #9ca3af;
        }
        .badge {
            padding: 3px 6px;
            border-radius: 999px;
            font-size: 10px;
        }
        .badge-dia {
            background: #0b1120;
            border: 1px solid #3b82f6;
        }
        .badge-rpe-alvo {
            background: #0b1120;
            border: 1px solid #f97316;
        }
        /* --- Estilo MOBILE para o treino do dia (cards) --- */
        .day-cards-wrapper {
            padding: 8px;
        }
        .exercise-card {
            border-radius: 12px;
            border: 1px solid #1f2937;
            background: #020617;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .exercise-header {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            align-items: center;
        }
        .exercise-title {
            font-size: 13px;
            font-weight: 600;
        }
        .exercise-sub {
            font-size: 11px;
            color: #9ca3af;
        }
        .exercise-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 11px;
        }
        .pill-small {
            padding: 2px 6px;
            border-radius: 999px;
            border: 1px solid #4b5563;
            font-size: 10px;
        }
        .exercise-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        @media (max-width: 640px) {
            .exercise-fields {
                grid-template-columns: 1fr;
            }
        }
        .field-block {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .field-block label {
            font-size: 11px;
        }
        input.cell-input, textarea.cell-input {
            width: 100%;
            box-sizing: border-box;
            border-radius: 8px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
            font-size: 12px;
            padding: 6px 8px;
        }
        textarea.cell-input {
            resize: vertical;
            min-height: 48px;
        }
        .cargas-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
        }
        .cargas-grid input {
            text-align: center;
        }
        @media (max-width: 640px) {
            .cargas-grid {
                grid-template-columns: repeat(4, minmax(0,1fr));
            }
        }
        .bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }
        .chk-label {
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .hidden {
            display: none;
        }
        .top-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        @media (max-width: 640px) {
            .top-actions {
                flex-direction: column;
            }
            .top-actions button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<header>
    <h1>Guerra Fit – Treinos</h1>
    <small>Guerra Fit · Treinos semanais com registro de carga, peso e RPE no próprio navegador.</small>
</header>
<main>
    <div class="card">
        <div class="row">
            <div class="col-6">
                <label for="fileInput">Arquivo de treinos (.csv ou .json)</label>
                <input type="file" id="fileInput" accept=".csv,.json" />
            </div>
            <div class="col-6">
                <label for="diaSelect">Dia do treino</label>
                <select id="diaSelect"></select>
            </div>
        </div>
        <div class="row" style="margin-top:8px;">
            <div class="col-6">
                <label for="dataInput">Data do treino</label>
                <input type="date" id="dataInput" />
            </div>
            <div class="col-6">
                <label>&nbsp;</label>
                <div class="pill">
                    <span class="pill-dot"></span>
                    <span>RPE alvo = planejado · RPE percebido = sua percepção real</span>
                </div>
            </div>
        </div>

        <div class="top-actions">
            <button id="btnExportJson" class="ghost-btn">Exportar dados (.json) para salvar no GitHub</button>
            <button id="btnVerEvolucao" class="link-btn primary">Ver evolução (abrir dashboard)</button>
        </div>

        <div class="status" id="statusText">Nenhum arquivo carregado ainda.</div>
        <div class="help-text" style="margin-top:4px;">
            Formato sugerido do .csv: Dia, Grupo, Exercício, Tipo, Séries, Reps alvo, RPE alvo, Intervalo (seg), Aquecimento?, Link vídeo/imagem.
        </div>
    </div>

    <div class="card">
        <div class="tabs">
            <button class="tab-btn active" data-tab="semana">Treinos da semana</button>
            <button class="tab-btn" data-tab="dia">Treino do dia</button>
        </div>

        <div id="tab-semana">
            <div style="overflow-x:auto;" class="scroll-box">
                <div id="semanaContainer"></div>
            </div>
        </div>

        <div id="tab-dia" class="hidden">
            <div id="diaContainer" class="scroll-box"></div>
        </div>
    </div>
</main>

<script>
let baseExercises = [];
let dailyLog = {};
const STORAGE_KEY = "treino_diario_guerra_v1_mobile";

function setStatus(msg) {
    const s = document.getElementById("statusText");
    if (s) s.textContent = msg;
}
function todayISO() {
    const d = new Date();
    const off = d.getTimezoneOffset();
    const local = new Date(d.getTime() - off*60*1000);
    return local.toISOString().slice(0,10);
}
function loadDailyLog() {
    try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        dailyLog = JSON.parse(raw);
    } catch (e) {
        console.error("Erro ao carregar dailyLog", e);
        dailyLog = {};
    }
}
function saveDailyLog() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyLog));
}
function normalizeDiaLabel(dia) {
    if (!dia) return "";
    return dia.toString().trim();
}
function parseCSV(text) {
    const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
    if (lines.length < 2) return [];
    let delimiter = ",";
    const firstLine = lines[0];
    const countComma = (firstLine.match(/,/g) || []).length;
    const countSemicolon = (firstLine.match(/;/g) || []).length;
    if (countSemicolon > countComma) delimiter = ";";
    const headers = lines[0].split(delimiter).map(h => h.trim());
    function getVal(cells, name) {
        const idx = headers.indexOf(name);
        if (idx === -1) return "";
        return (cells[idx] || "").trim();
    }
    const rows = [];
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.trim()) continue;
        const cells = line.split(delimiter);
        const row = {
            dia: getVal(cells, "Dia"),
            grupo: getVal(cells, "Grupo"),
            exercicio: getVal(cells, "Exercício") || getVal(cells, "Exercicio"),
            tipo: getVal(cells, "Tipo"),
            series: getVal(cells, "Séries") || getVal(cells, "Series"),
            repsAlvo: getVal(cells, "Reps alvo") || getVal(cells, "Reps"),
            rpeAlvo: getVal(cells, "RPE alvo") || getVal(cells, "RPE"),
            intervaloSeg: getVal(cells, "Intervalo (seg)") || getVal(cells, "Intervalo"),
            aquecimento: getVal(cells, "Aquecimento?") || getVal(cells, "Aquecimento"),
            midia: getVal(cells, "Link vídeo/imagem") || getVal(cells, "Midia") || getVal(cells, "Mídia")
        };
        if (Object.values(row).every(v => !v)) continue;
        rows.push(row);
    }
    return rows;
}
function parseJSON(text) {
    const data = JSON.parse(text);
    if (!Array.isArray(data)) return [];
    return data.map((r) => ({
        dia: r.Dia || r.dia || "",
        grupo: r.Grupo || r.grupo || "",
        exercicio: r["Exercício"] || r.exercicio || r.Exercicio || "",
        tipo: r.Tipo || r.tipo || "",
        series: r["Séries"] || r.series || r.Series || "",
        repsAlvo: r["Reps alvo"] || r.repsAlvo || r.Reps || "",
        rpeAlvo: r["RPE alvo"] || r.rpeAlvo || r.RPE || "",
        intervaloSeg: r["Intervalo (seg)"] || r.intervaloSeg || r.Intervalo || "",
        aquecimento: r["Aquecimento?"] || r.aquecimento || r.Aquecimento || "",
        midia: r["Link vídeo/imagem"] || r.midia || r.Midia || ""
    }));
}
function handleFile(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const text = e.target.result;
            let rows = [];
            if (file.name.toLowerCase().endsWith(".json")) {
                rows = parseJSON(text);
            } else {
                rows = parseCSV(text);
            }
            if (!rows.length) {
                setStatus("Arquivo carregado, mas não foi possível ler exercícios.");
                return;
            }
            baseExercises = rows.map((r, idx) => ({ id: "ex_" + idx, ...r }));
            setStatus("Arquivo carregado com " + baseExercises.length + " exercícios.");
            rebuildDiaOptions();
            renderSemana();
            renderDia();
        } catch (err) {
            console.error(err);
            setStatus("Erro ao ler arquivo: " + err.message);
        }
    };
    reader.readAsText(file, "utf-8");
}
function groupByDia() {
    const map = {};
    baseExercises.forEach(ex => {
        const dia = normalizeDiaLabel(ex.dia);
        if (!dia) return;
        if (!map[dia]) map[dia] = [];
        map[dia].push(ex);
    });
    return map;
}
function renderSemana() {
    const container = document.getElementById("semanaContainer");
    if (!container) return;
    container.innerHTML = "";
    if (!baseExercises.length) {
        container.innerHTML = "<div style='padding:8px;font-size:12px;color:#9ca3af;'>Carregue um arquivo para ver os treinos da semana.</div>";
        return;
    }
    const byDia = groupByDia();
    const diasOrdenados = Object.keys(byDia);
    if (!diasOrdenados.length) {
        container.innerHTML = "<div style='padding:8px;font-size:12px;color:#9ca3af;'>Nenhum dia encontrado no arquivo.</div>";
        return;
    }
    diasOrdenados.forEach(dia => {
        const sectionTitle = document.createElement("div");
        sectionTitle.className = "week-section-title";
        sectionTitle.innerHTML = "<span class='badge badge-dia'>" + dia + "</span><span>" + byDia[dia].length + " exercícios</span>";
        container.appendChild(sectionTitle);
        const table = document.createElement("table");
        const thead = document.createElement("thead");
        thead.innerHTML = "<tr>" +
            "<th>Grupo</th>" +
            "<th>Exercício</th>" +
            "<th>Tipo</th>" +
            "<th>Séries</th>" +
            "<th>Reps</th>" +
            "<th>RPE alvo</th>" +
            "<th>Intervalo (s)</th>" +
            "<th>Aquecimento</th>" +
            "<th>Mídia</th>" +
            "</tr>";
        table.appendChild(thead);
        const tbody = document.createElement("tbody");
        byDia[dia].forEach(ex => {
            const tr = document.createElement("tr");
            tr.innerHTML =
                "<td>" + (ex.grupo || "") + "</td>" +
                "<td>" + (ex.exercicio || "") + "</td>" +
                "<td>" + (ex.tipo || "") + "</td>" +
                "<td>" + (ex.series || "") + "</td>" +
                "<td>" + (ex.repsAlvo || "") + "</td>" +
                "<td>" + (ex.rpeAlvo || "") + "</td>" +
                "<td>" + (ex.intervaloSeg || "") + "</td>" +
                "<td>" + (ex.aquecimento || "") + "</td>" +
                "<td>" + (ex.midia ? "<button class='link-btn' onclick=\"window.open('" + ex.midia + "', '_blank')\">Abrir</button>" : "") + "</td>";
            tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        container.appendChild(table);
    });
}
function getDiaSelecionado() {
    const sel = document.getElementById("diaSelect");
    if (!sel) return "";
    return sel.value || "";
}
function getDataSelecionada() {
    const inp = document.getElementById("dataInput");
    if (!inp) return todayISO();
    return inp.value || todayISO();
}
function keyForLog(exId, dateStr) {
    return exId + "::" + dateStr;
}
function getLogFor(exId, dateStr) {
    const key = keyForLog(exId, dateStr);
    return dailyLog[key] || {
        peso: "",
        rpePercebido: "",
        carga1: "",
        carga2: "",
        carga3: "",
        carga4: "",
        obs: "",
        concluido: false
    };
}
function updateLogField(exId, field, value) {
    const dateStr = getDataSelecionada();
    const key = keyForLog(exId, dateStr);
    const current = dailyLog[key] || {
        peso: "",
        rpePercebido: "",
        carga1: "",
        carga2: "",
        carga3: "",
        carga4: "",
        obs: "",
        concluido: false
    };
    current[field] = value;
    dailyLog[key] = current;
    saveDailyLog();
}
function updateLogCheckbox(exId, field, checked) {
    updateLogField(exId, field, !!checked);
}
function renderDia() {
    const container = document.getElementById("diaContainer");
    if (!container) return;
    container.innerHTML = "";
    if (!baseExercises.length) {
        container.innerHTML = "<div style='padding:8px;font-size:12px;color:#9ca3af;'>Carregue um arquivo para ver o treino do dia.</div>";
        return;
    }
    const diaSel = getDiaSelecionado();
    const dataSel = getDataSelecionada();
    if (!diaSel) {
        container.innerHTML = "<div style='padding:8px;font-size:12px;color:#9ca3af;'>Selecione o dia do treino.</div>";
        return;
    }
    const exDia = baseExercises.filter(ex => normalizeDiaLabel(ex.dia) === diaSel);
    if (!exDia.length) {
        container.innerHTML = "<div style='padding:8px;font-size:12px;color:#9ca3af;'>Nenhum exercício encontrado para \"" + diaSel + "\".</div>";
        return;
    }
    const info = document.createElement("div");
    info.className = "help-text";
    info.style.margin = "6px 8px";
    info.innerHTML = "Treino de <b>" + diaSel + "</b> em " + dataSel + ". Preencha peso corporal, cargas, RPE percebido e marque concluído.";
    container.appendChild(info);
    const wrapper = document.createElement("div");
    wrapper.className = "day-cards-wrapper";
    exDia.forEach(ex => {
        const log = getLogFor(ex.id, dataSel);
        const card = document.createElement("div");
        card.className = "exercise-card";
        const header = document.createElement("div");
        header.className = "exercise-header";
        const left = document.createElement("div");
        const title = document.createElement("div");
        title.className = "exercise-title";
        title.textContent = ex.exercicio || "";
        const subtitle = document.createElement("div");
        subtitle.className = "exercise-sub";
        subtitle.textContent = (ex.grupo || "") + (ex.tipo ? " · " + ex.tipo : "");
        left.appendChild(title);
        left.appendChild(subtitle);
        header.appendChild(left);
        const badge = document.createElement("div");
        badge.className = "badge badge-rpe-alvo";
        badge.textContent = "RPE alvo: " + (ex.rpeAlvo || "");
        header.appendChild(badge);
        card.appendChild(header);
        const meta = document.createElement("div");
        meta.className = "exercise-meta";
        const pill1 = document.createElement("div");
        pill1.className = "pill-small";
        pill1.textContent = (ex.series || "") + " x " + (ex.repsAlvo || "");
        const pill2 = document.createElement("div");
        pill2.className = "pill-small";
        pill2.textContent = "Intervalo: " + (ex.intervaloSeg || "") + "s";
        const pill3 = document.createElement("div");
        pill3.className = "pill-small";
        pill3.textContent = ex.aquecimento ? ("Aquecimento: " + ex.aquecimento) : "Aquecimento: padrão";
        meta.appendChild(pill1);
        meta.appendChild(pill2);
        meta.appendChild(pill3);
        card.appendChild(meta);
        const fields = document.createElement("div");
        fields.className = "exercise-fields";
        const fbPeso = document.createElement("div");
        fbPeso.className = "field-block";
        const lbPeso = document.createElement("label");
        lbPeso.textContent = "Peso corporal (kg)";
        const inpPeso = document.createElement("input");
        inpPeso.type = "number";
        inpPeso.step = "0.1";
        inpPeso.className = "cell-input";
        inpPeso.value = log.peso || "";
        inpPeso.onchange = (e) => updateLogField(ex.id, "peso", e.target.value);
        fbPeso.appendChild(lbPeso);
        fbPeso.appendChild(inpPeso);
        fields.appendChild(fbPeso);
        const fbRPE = document.createElement("div");
        fbRPE.className = "field-block";
        const lbRPE = document.createElement("label");
        lbRPE.textContent = "RPE percebido (1–10)";
        const inpRPE = document.createElement("input");
        inpRPE.type = "number";
        inpRPE.step = "0.5";
        inpRPE.min = "1";
        inpRPE.max = "10";
        inpRPE.className = "cell-input";
        inpRPE.value = log.rpePercebido || "";
        inpRPE.onchange = (e) => updateLogField(ex.id, "rpePercebido", e.target.value);
        fbRPE.appendChild(lbRPE);
        fbRPE.appendChild(inpRPE);
        fields.appendChild(fbRPE);
        const fbCargas = document.createElement("div");
        fbCargas.className = "field-block";
        const lbCargas = document.createElement("label");
        lbCargas.textContent = "Cargas (S1–S4)";
        const cg = document.createElement("div");
        cg.className = "cargas-grid";
        ["carga1","carga2","carga3","carga4"].forEach((field, idx) => {
            const inp = document.createElement("input");
            inp.type = "number";
            inp.step = "0.5";
            inp.className = "cell-input";
            inp.placeholder = "S" + (idx + 1);
            inp.value = log[field] || "";
            inp.onchange = (e) => updateLogField(ex.id, field, e.target.value);
            cg.appendChild(inp);
        });
        fbCargas.appendChild(lbCargas);
        fbCargas.appendChild(cg);
        fields.appendChild(fbCargas);
        const fbObs = document.createElement("div");
        fbObs.className = "field-block";
        const lbObs = document.createElement("label");
        lbObs.textContent = "Observações";
        const taObs = document.createElement("textarea");
        taObs.className = "cell-input";
        taObs.value = log.obs || "";
        taObs.onchange = (e) => updateLogField(ex.id, "obs", e.target.value);
        fbObs.appendChild(lbObs);
        fbObs.appendChild(taObs);
        fields.appendChild(fbObs);
        card.appendChild(fields);
        const bottom = document.createElement("div");
        bottom.className = "bottom-row";
        const chkWrap = document.createElement("label");
        chkWrap.className = "chk-label";
        const chk = document.createElement("input");
        chk.type = "checkbox";
        chk.checked = !!log.concluido;
        chk.onchange = (e) => updateLogCheckbox(ex.id, "concluido", e.target.checked);
        chkWrap.appendChild(chk);
        const txtChk = document.createElement("span");
        txtChk.textContent = "Exercício concluído";
        chkWrap.appendChild(txtChk);
        bottom.appendChild(chkWrap);
        if (ex.midia) {
            const btn = document.createElement("button");
            btn.className = "link-btn";
            btn.textContent = "Vídeo / imagem";
            btn.onclick = () => window.open(ex.midia, "_blank");
            bottom.appendChild(btn);
        }
        card.appendChild(bottom);
        wrapper.appendChild(card);
    });
    container.appendChild(wrapper);
}
function rebuildDiaOptions() {
    const sel = document.getElementById("diaSelect");
    if (!sel) return;
    const dias = Array.from(new Set(baseExercises.map(ex => normalizeDiaLabel(ex.dia)))).filter(Boolean);
    sel.innerHTML = "";
    const optEmpty = document.createElement("option");
    optEmpty.value = "";
    optEmpty.textContent = "Selecione...";
    sel.appendChild(optEmpty);
    dias.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        sel.appendChild(opt);
    });
    const hoje = new Date();
    const wd = hoje.getDay();
    const map = {
        0: "Domingo",
        1: "Segunda",
        2: "Terça",
        3: "Quarta",
        4: "Quinta",
        5: "Sexta",
        6: "Sábado"
    };
    const nomeHoje = map[wd] || "";
    const found = dias.find(d => d.toLowerCase().startsWith(nomeHoje.toLowerCase().slice(0,3)));
    if (found) sel.value = found;
}
function initDate() {
    const inp = document.getElementById("dataInput");
    if (!inp) return;
    if (!inp.value) inp.value = todayISO();
}
function initTabs() {
    const buttons = document.querySelectorAll(".tab-btn");
    buttons.forEach(btn => {
        btn.addEventListener("click", () => {
            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const tab = btn.dataset.tab;
            document.getElementById("tab-semana").classList.add("hidden");
            document.getElementById("tab-dia").classList.add("hidden");
            if (tab === "semana") {
                document.getElementById("tab-semana").classList.remove("hidden");
            } else {
                document.getElementById("tab-dia").classList.remove("hidden");
            }
        });
    });
}

// Exporta os dados (dailyLog) em JSON para download
function exportJsonLogs() {
    try {
        const dataStr = JSON.stringify(dailyLog, null, 2);
        const blob = new Blob([dataStr], { type: "application/json;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "guerra_fit_logs.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        setStatus("Arquivo guerra_fit_logs.json exportado. Envie esse arquivo para o seu repositório no GitHub para versionar sua evolução.");
    } catch (e) {
        console.error(e);
        setStatus("Erro ao exportar JSON de evolução.");
    }
}

// Abre o dashboard de análise (analise.html)
function openAnalise() {
    window.open("analise.html", "_blank");
}

document.addEventListener("DOMContentLoaded", () => {
    loadDailyLog();
    initTabs();
    initDate();

    const fileInput = document.getElementById("fileInput");
    if (fileInput) {
        fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                setStatus("Lendo arquivo de treinos: " + file.name + "...");
                handleFile(file);
            }
        });
    }
    const diaSelect = document.getElementById("diaSelect");
    if (diaSelect) {
        diaSelect.addEventListener("change", () => renderDia());
    }
    const dataInput = document.getElementById("dataInput");
    if (dataInput) {
        dataInput.addEventListener("change", () => renderDia());
    }

    const btnExport = document.getElementById("btnExportJson");
    if (btnExport) {
        btnExport.addEventListener("click", exportJsonLogs);
    }
    const btnEvol = document.getElementById("btnVerEvolucao");
    if (btnEvol) {
        btnEvol.addEventListener("click", openAnalise);
    }

    renderSemana();
    renderDia();
});
</script>
</body>
</html>
