<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Guerra Fit 2.0 ‚Äì DevFit Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" /> <style>
    /* --- DESIGN SYSTEM & VARS --- */
    :root {
      --bg-app: #09090b; /* Zinco muito escuro */
      --bg-card: #18181b; /* Zinco escuro */
      --bg-input: #27272a;
      --border: #3f3f46;
      
      --text-main: #f4f4f5;
      --text-muted: #a1a1aa;
      
      --primary: #22c55e; /* Green 500 - Conclus√£o/Cardio */
      --primary-glow: rgba(34, 197, 94, 0.2);
      
      --accent-strength: #ef4444; /* Red 500 - For√ßa */
      --accent-warmup: #3b82f6; /* Blue 500 - Aquecimento */
      
      --radius: 12px;
      --font-stack: 'Inter', system-ui, -apple-system, sans-serif;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      background: var(--bg-app);
      color: var(--text-main);
      font-family: var(--font-stack);
      font-size: 14px;
      padding-bottom: 80px; /* Espa√ßo para scroll final */
    }

    /* --- TYPOGRAPHY & HEADER --- */
    header {
      background: rgba(9, 9, 11, 0.95);
      border-bottom: 1px solid var(--border);
      padding: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(5px);
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: -0.5px;
      color: var(--text-main);
      text-transform: uppercase;
    }
    header small {
      color: var(--text-muted);
      font-size: 11px;
      display: block;
      margin-top: 4px;
    }

    main {
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* --- GAMIFICATION: PROGRESS BAR --- */
    .progress-wrapper {
      margin-top: 12px;
      background: var(--bg-input);
      height: 8px;
      border-radius: 99px;
      overflow: hidden;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      width: 0%;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 10px var(--primary-glow);
    }
    .progress-text {
      font-size: 10px;
      color: var(--text-muted);
      text-align: right;
      margin-top: 4px;
    }

    /* --- CARDS & LAYOUT --- */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .row { display: flex; flex-wrap: wrap; gap: 12px; }
    .col-6 { flex: 1 1 45%; min-width: 140px; }

    /* --- FORMS & INPUTS (Mobile Friendly) --- */
    label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 6px;
      display: block;
      font-weight: 600;
    }
    
    input, select, textarea {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px; /* Touch target maior */
      color: var(--text-main);
      font-size: 16px; /* Evita zoom no iOS */
      outline: none;
      transition: border-color 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
    }
    
    /* Bot√µes */
    button {
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      background: var(--bg-input);
      color: var(--text-main);
      font-weight: 600;
      cursor: pointer;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }
    button:active { transform: scale(0.98); }
    button.primary {
      background: var(--primary);
      color: #000;
      border: none;
      box-shadow: 0 0 15px var(--primary-glow);
    }

    /* --- NAVIGATION TABS --- */
    .tab-nav {
      display: flex;
      background: var(--bg-input);
      padding: 4px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .tab-nav button {
      flex: 1;
      background: transparent;
      border: none;
      padding: 10px;
      font-size: 13px;
      border-radius: 8px;
      color: var(--text-muted);
    }
    .tab-nav button.active {
      background: var(--bg-card);
      color: var(--text-main);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* --- EXERCISE CARDS --- */
    .exercise-card {
      background: var(--bg-card);
      border-left: 4px solid var(--border);
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      position: relative;
    }
    /* Cores por tipo */
    .type-strength { border-left-color: var(--accent-strength); }
    .type-cardio { border-left-color: var(--primary); }
    .type-warmup { border-left-color: var(--accent-warmup); }

    .ex-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .ex-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-main);
    }
    .ex-meta {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .pill {
      background: var(--bg-input);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      border: 1px solid var(--border);
    }

    /* Inputs Grid */
    .ex-inputs {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 12px;
    }
    .input-group { display: flex; flex-direction: column; }
    
    .carga-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
    }
    .carga-grid input {
      padding: 8px 4px;
      text-align: center;
      font-size: 13px;
    }

    /* Checkbox Footer */
    .ex-footer {
      border-top: 1px solid var(--border);
      padding-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Custom Checkbox Big Target */
    .check-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .custom-checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    input[type="checkbox"]:checked + .custom-checkbox {
      background: var(--primary);
      border-color: var(--primary);
    }
    input[type="checkbox"]:checked + .custom-checkbox::after {
      content: '‚úî';
      color: #000;
      font-size: 14px;
      font-weight: bold;
    }

    /* --- UTILS --- */
    .hidden { display: none !important; }
    .help-text { font-size: 12px; color: var(--text-muted); margin-top: 8px; text-align: center; }
    
    /* Disclaimer Footer */
    footer.disclaimer {
      margin-top: 40px;
      padding: 20px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: #52525b;
      font-size: 10px;
    }
  </style>
</head>

<body>

<header>
  <h1>Guerra Fit <span style="color:var(--primary)">//</span> Coach</h1>
  <small>Treino, Dieta & Ci√™ncia</small>
  
  <div id="progressBarContainer" class="hidden">
    <div class="progress-wrapper">
      <div id="dailyProgress" class="progress-fill"></div>
    </div>
    <div id="progressText" class="progress-text">0% Conclu√≠do</div>
  </div>
</header>

<main>
  <div class="tab-nav">
    <button class="active" onclick="switchMainTab('treino')">üèãÔ∏è Treinos</button>
    <button onclick="switchMainTab('dieta')">ü•ó Dieta</button>
  </div>

  <div id="view-treino">
    
    <div class="card">
      <div class="row">
        <div class="col-6">
          <label>Dia da Semana</label>
          <select id="diaSelect"></select>
        </div>
        <div class="col-6">
          <label>Data</label>
          <input type="date" id="dataInput" />
        </div>
      </div>
      
      <details style="margin-top:12px; color:var(--text-muted); font-size:12px;">
        <summary style="cursor:pointer; padding:5px;">Op√ß√µes Avan√ßadas & Upload</summary>
        <div style="margin-top:10px; padding:10px; border:1px dashed var(--border); border-radius:8px;">
           <label>Sobrescrever com CSV:</label>
           <input type="file" id="csvInput" accept=".csv" style="padding:6px; font-size:12px;" />
           <div style="margin-top:8px; display:flex; gap:10px;">
             <button onclick="exportJson()" style="font-size:11px;">üíæ Backup (JSON)</button>
             <button onclick="resetDia()" style="font-size:11px; color:#ef4444; border-color:#ef4444;">üóëÔ∏è Limpar Hoje</button>
           </div>
        </div>
      </details>
    </div>

    <div class="tab-nav" style="margin-bottom:10px; font-size:12px;">
      <button class="active" data-sub="dia" onclick="switchSubTab('treino', 'dia')">Treino do Dia</button>
      <button data-sub="cardio" onclick="switchSubTab('treino', 'cardio')">Resumo Cardio</button>
    </div>

    <div id="tab-dia">
      <div id="diaContainer"></div>
    </div>

    <div id="tab-cardio" class="hidden">
      <div class="card" style="border-color: var(--primary);">
        <h3 style="margin:0 0 10px 0; color:var(--primary)">Cardio Hoje</h3>
        <div id="cardioDiaResumo" style="font-size:16px; font-weight:bold;"></div>
      </div>
      <div class="card">
        <h3 style="margin:0 0 10px 0; color:var(--text-muted)">√öltimos 7 dias</h3>
        <div id="cardioSemanaResumo" style="font-size:14px;"></div>
      </div>
    </div>
  </div>

  <div id="view-dieta" class="hidden">
    <div class="card">
      <h3 style="margin-top:0;">Planejamento Nutricional</h3>
      <div class="tab-nav" style="margin-bottom:0;">
        <button class="active" data-sub="menu" onclick="switchSubTab('dieta', 'menu')">Card√°pio</button>
        <button data-sub="shopping" onclick="switchSubTab('dieta', 'shopping')">Lista de Compras</button>
      </div>
    </div>

    <div id="diet-menu">
      <div id="menuContainer"></div>
    </div>

    <div id="diet-shopping" class="hidden">
      <div class="card">
        <div id="shoppingContainer"></div>
      </div>
    </div>
  </div>

</main>

<footer class="disclaimer">
  <strong>AVISO LEGAL:</strong> Este aplicativo serve apenas para registro de dados. Consulte um profissional de educa√ß√£o f√≠sica e nutricionista antes de iniciar qualquer rotina.
</footer>

<script>
  // =========================================================
  // 1. BASE DE DADOS INTERNA (JSON - "HARDCODED")
  // EDITE AQUI PARA MUDAR SEU TREINO PADR√ÉO
  // =========================================================
  const DEFAULT_TREINOS = [
    // --- TREINO A: PEITO, OMBRO, TR√çCEPS ---
    { dia: "Segunda", grupo: "Peito", exercicio: "Supino Reto (Halter ou Barra)", series: "4", repsTempo: "8-10", rpeZona: "8-9", tipo: "For√ßa", obs: "Foco na descida controlada" },
    { dia: "Segunda", grupo: "Peito", exercicio: "Supino Inclinado", series: "3", repsTempo: "10-12", rpeZona: "8", tipo: "For√ßa" },
    { dia: "Segunda", grupo: "Ombro", exercicio: "Eleva√ß√£o Lateral", series: "4", repsTempo: "12-15", rpeZona: "Falha", tipo: "Hipertrofia" },
    { dia: "Segunda", grupo: "Tr√≠ceps", exercicio: "Tr√≠ceps Corda", series: "4", repsTempo: "10-12", rpeZona: "9", tipo: "For√ßa" },
    { dia: "Segunda", grupo: "Cardio", exercicio: "Esteira", series: "1", repsTempo: "20 min", rpeZona: "Zona 2", tipo: "Cardio" },
    
    // --- TREINO B: COSTAS, B√çCEPS ---
    { dia: "Ter√ßa", grupo: "Costas", exercicio: "Puxada Alta (Pulley)", series: "4", repsTempo: "10", rpeZona: "9", tipo: "For√ßa" },
    { dia: "Ter√ßa", grupo: "Costas", exercicio: "Remada Curvada", series: "4", repsTempo: "8-10", rpeZona: "9", tipo: "For√ßa" },
    { dia: "Ter√ßa", grupo: "B√≠ceps", exercicio: "Rosca Direta", series: "4", repsTempo: "10-12", rpeZona: "Falha", tipo: "Hipertrofia" },
    { dia: "Ter√ßa", grupo: "Cardio", exercicio: "Corrida Rua", series: "1", repsTempo: "5km", rpeZona: "Moderado", tipo: "Corrida" },

    // --- EXEMPLO RESTO DA SEMANA ---
    { dia: "Quarta", grupo: "Pernas", exercicio: "Agachamento Livre", series: "4", repsTempo: "6-8", rpeZona: "9", tipo: "For√ßa" },
    { dia: "Quinta", grupo: "Descanso", exercicio: "Alongamento / Mobilidade", series: "1", repsTempo: "20 min", rpeZona: "Leve", tipo: "Recupera√ß√£o" },
    { dia: "Sexta", grupo: "FullBody", exercicio: "Levantamento Terra", series: "3", repsTempo: "5", rpeZona: "9.5", tipo: "For√ßa" }
  ];

  const DEFAULT_DIETA = [
    { dia: "Segunda", refeicao: "Caf√© da Manh√£", item: "Ovos Mexidos", quantidade: "3", unidade: "uni", grupo: "Prote√≠na" },
    { dia: "Segunda", refeicao: "Caf√© da Manh√£", item: "P√£o Integral", quantidade: "2", unidade: "fatias", grupo: "Carbo" },
    { dia: "Segunda", refeicao: "Almo√ßo", item: "Frango Grelhado", quantidade: "150", unidade: "g", grupo: "Prote√≠na" },
    { dia: "Segunda", refeicao: "Almo√ßo", item: "Arroz Branco", quantidade: "200", unidade: "g", grupo: "Carbo" },
    { dia: "Segunda", refeicao: "Jantar", item: "Carne Mo√≠da", quantidade: "150", unidade: "g", grupo: "Prote√≠na" },
    // Adicione mais dias e refei√ß√µes aqui seguindo o padr√£o
  ];

  // =========================================================
  // 2. SISTEMA (L√ìGICA)
  // =========================================================
  const STORAGE_KEY = "guerra_fit_logs_v4";
  const SHOPPING_KEY = "guerra_fit_shopping_v4";

  let baseExercises = [];
  let nutritionEntries = [];
  let dailyLog = {};

  // Utilit√°rios de Data
  function todayISO() {
    const d = new Date();
    const off = d.getTimezoneOffset();
    const local = new Date(d.getTime() - off * 60000);
    return local.toISOString().slice(0, 10);
  }
  
  function getDiaSemana(dateString) {
    const d = new Date(dateString);
    const dias = ["Domingo", "Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado"];
    return dias[d.getUTCDay()]; // Use UTC to avoid timezone shift issues on pure dates
  }

  // Init Data
  function initData() {
    // 1. Tenta carregar Logs
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      dailyLog = raw ? JSON.parse(raw) : {};
    } catch { dailyLog = {}; }

    // 2. Carrega Treinos (Prioridade: CSV se o usu√°rio tivesse carregado antes? N√£o, aqui vamos de JSON padr√£o para simplificar, upload √© sess√£o atual)
    // Se quiser persistir CSV, precisaria salvar o CSV string no localStorage.
    // Vamos usar a H√≠brida: Carrega Default. Se upload, substitui.
    baseExercises = [...DEFAULT_TREINOS];
    nutritionEntries = [...DEFAULT_DIETA];

    // Setup inicial
    const dataInput = document.getElementById("dataInput");
    dataInput.value = todayISO();
    
    rebuildDiaOptions();
    
    // Auto-seleciona dia da semana
    const hojeNome = getDiaSemana(dataInput.value);
    const sel = document.getElementById("diaSelect");
    // Tenta achar o dia de hoje nas op√ß√µes
    for(let i=0; i<sel.options.length; i++) {
        if(sel.options[i].value === hojeNome) {
            sel.selectedIndex = i;
            break;
        }
    }
    
    renderApp();
  }

  function saveLog() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyLog));
    updateProgressBar();
    updateCardioSummary();
  }

  // --- RENDERING CORE ---
  function renderApp() {
    renderDia();
    renderDieta();
    updateProgressBar();
  }

  // --- RENDER TREINO ---
  function rebuildDiaOptions() {
    const sel = document.getElementById("diaSelect");
    sel.innerHTML = "";
    
    // Pega dias √∫nicos do objeto baseExercises
    const diasUnicos = [...new Set(baseExercises.map(e => e.dia))];
    
    // Ordem customizada
    const ordem = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"];
    diasUnicos.sort((a,b) => ordem.indexOf(a) - ordem.indexOf(b));

    diasUnicos.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = d;
      sel.appendChild(opt);
    });
  }

  function renderDia() {
    const container = document.getElementById("diaContainer");
    const diaSel = document.getElementById("diaSelect").value;
    const dataSel = document.getElementById("dataInput").value;
    
    container.innerHTML = "";

    const treinosDoDia = baseExercises.filter(e => e.dia === diaSel);
    
    if (treinosDoDia.length === 0) {
      container.innerHTML = `<div class="help-text">üå¥ Descanso ou sem treino cadastrado.</div>`;
      document.getElementById("progressBarContainer").classList.add("hidden");
      return;
    }
    
    document.getElementById("progressBarContainer").classList.remove("hidden");

    treinosDoDia.forEach((ex, idx) => {
      const exId = `ex_${idx}_${diaSel}`; // ID √∫nico baseado na posi√ß√£o e dia
      const key = `${exId}::${dataSel}`; // Chave do Log: ID + Data
      
      // Inicializa log se n√£o existir
      if (!dailyLog[key]) dailyLog[key] = { concluido: false };
      const log = dailyLog[key];

      // Determina tipo para cor
      const isCardio = (ex.tipo || "").toLowerCase().includes("cardio") || (ex.tipo || "").toLowerCase().includes("corrida");
      const isWarmup = (ex.tipo || "").toLowerCase().includes("aquecimento");
      let typeClass = "type-strength";
      if(isCardio) typeClass = "type-cardio";
      if(isWarmup) typeClass = "type-warmup";

      // HTML do Card
      const card = document.createElement("div");
      card.className = `exercise-card ${typeClass}`;
      
      // Header
      let html = `
        <div class="ex-header">
          <div>
            <div class="ex-title">${ex.exercicio}</div>
            <div class="ex-meta">${ex.grupo} ‚Ä¢ ${ex.tipo || "Geral"}</div>
          </div>
          <div class="pill">${ex.repsTempo}</div>
        </div>
      `;

      // Inputs
      html += `<div class="ex-inputs">`;
      
      // Peso Corporal
      html += `
        <div class="input-group">
          <label>Peso (kg)</label>
          <input type="number" step="0.1" value="${log.peso || ''}" onchange="updateLog('${key}', 'peso', this.value)">
        </div>
      `;
      
      // RPE (ou Distancia se cardio)
      if (isCardio) {
        html += `
          <div class="input-group">
            <label>Dist√¢ncia (km)</label>
            <input type="number" step="0.1" value="${log.distCardioKm || ''}" onchange="updateLog('${key}', 'distCardioKm', this.value)">
          </div>
        `;
      } else {
        html += `
          <div class="input-group">
            <label>RPE (1-10)</label>
            <input type="number" step="0.5" value="${log.rpe || ''}" onchange="updateLog('${key}', 'rpe', this.value)">
          </div>
        `;
      }
      html += `</div>`; // fecha grid inputs principais

      // Cargas (se n√£o for s√≥ cardio)
      if (!isCardio && !isWarmup) {
         html += `<label>Cargas (kg) por s√©rie</label><div class="carga-grid">`;
         for(let i=1; i<=4; i++) {
           html += `<input type="number" placeholder="S${i}" value="${log['carga'+i] || ''}" onchange="updateLog('${key}', 'carga${i}', this.value)">`;
         }
         html += `</div>`;
      }
      
      // Observa√ß√µes (Textarea pequena)
      html += `
        <div style="margin-top:10px;">
           <input type="text" placeholder="Observa√ß√µes..." value="${log.obs || ''}" style="font-size:12px; padding:8px;" onchange="updateLog('${key}', 'obs', this.value)">
        </div>
      `;

      // Footer Checkbox
      html += `
        <div class="ex-footer">
          <label class="check-wrapper">
             <input type="checkbox" class="hidden" ${log.concluido ? 'checked' : ''} onchange="updateLog('${key}', 'concluido', this.checked)">
             <div class="custom-checkbox"></div>
             <span style="font-size:13px; font-weight:600; color:${log.concluido ? 'var(--primary)' : 'var(--text-muted)'}">
               ${log.concluido ? 'CONCLU√çDO' : 'MARCAR COMO FEITO'}
             </span>
          </label>
        </div>
      `;

      card.innerHTML = html;
      container.appendChild(card);
    });
    
    updateCardioSummary(); // Atualiza resumo cardio
  }

  // --- L√ìGICA DE UPDATE ---
  window.updateLog = function(key, field, value) {
    if (!dailyLog[key]) dailyLog[key] = {};
    dailyLog[key][field] = value;
    saveLog();
    
    // Se mudou checkbox, re-renderiza textos visuais se necess√°rio ou apenas a barra
    if (field === 'concluido') {
       renderDia(); // Re-render para atualizar a cor do texto "Conclu√≠do"
    }
  };

  function updateProgressBar() {
    const diaSel = document.getElementById("diaSelect").value;
    const dataSel = document.getElementById("dataInput").value;
    
    // Conta total de exercicios do dia
    const totalEx = baseExercises.filter(e => e.dia === diaSel).length;
    if (totalEx === 0) return;

    // Conta concluidos
    let concluidos = 0;
    baseExercises.filter(e => e.dia === diaSel).forEach((ex, idx) => {
       const key = `ex_${idx}_${diaSel}::${dataSel}`;
       if (dailyLog[key] && dailyLog[key].concluido) concluidos++;
    });

    const pct = Math.round((concluidos / totalEx) * 100);
    const bar = document.getElementById("dailyProgress");
    const txt = document.getElementById("progressText");
    
    bar.style.width = pct + "%";
    txt.textContent = `${pct}% Conclu√≠do (${concluidos}/${totalEx})`;
    
    // Feedback visual extra
    if(pct === 100) {
      bar.style.boxShadow = "0 0 15px #fff";
      txt.textContent = "üèÜ TREINO FINALIZADO! BOM TRABALHO.";
      txt.style.color = "var(--primary)";
    }
  }

  function updateCardioSummary() {
      // Simplificado para essa vers√£o
      const div = document.getElementById("cardioDiaResumo");
      const diaSel = document.getElementById("diaSelect").value;
      const dataSel = document.getElementById("dataInput").value;
      
      let kmTotal = 0;
      
      baseExercises.forEach((ex, idx) => {
          if (ex.dia !== diaSel) return;
          const key = `ex_${idx}_${diaSel}::${dataSel}`;
          if (dailyLog[key] && dailyLog[key].distCardioKm) {
              kmTotal += parseFloat(dailyLog[key].distCardioKm);
          }
      });
      
      if(kmTotal > 0) div.textContent = `${kmTotal.toFixed(2)} km`;
      else div.textContent = "Sem registro de dist√¢ncia.";
  }

  // --- DIETA ---
  function renderDieta() {
    const container = document.getElementById("menuContainer");
    const shoppingContainer = document.getElementById("shoppingContainer");
    
    // L√≥gica simplificada: Mostra dieta inteira ou filtra por dia (vamos mostrar tudo agrupado por dia para scrollar)
    // Mas o usu√°rio pediu "Card√°pio do Dia".
    
    const dataSel = document.getElementById("dataInput").value;
    const diaNome = getDiaSemana(dataSel); // ex: Segunda
    
    // 1. Menu do Dia
    const itensDia = nutritionEntries.filter(i => i.dia === diaNome);
    
    if(itensDia.length === 0) {
        container.innerHTML = `<div class="help-text">Sem dieta cadastrada para ${diaNome}.</div>`;
    } else {
        let html = "";
        // Agrupa por refei√ß√£o
        const refeicoes = [...new Set(itensDia.map(i => i.refeicao))];
        
        refeicoes.forEach(ref => {
            html += `<div class="card" style="padding:12px;">`;
            html += `<h4 style="margin:0 0 8px 0; color:var(--primary)">${ref}</h4>`;
            html += `<ul style="margin:0; padding-left:20px; font-size:13px; color:var(--text-muted)">`;
            
            itensDia.filter(i => i.refeicao === ref).forEach(item => {
                html += `<li><b>${item.quantidade}${item.unidade}</b> ${item.item}</li>`;
            });
            
            html += `</ul></div>`;
        });
        container.innerHTML = html;
    }

    // 2. Shopping List (Todos os dias)
    // Agrupa itens iguais
    let shoppingList = {};
    nutritionEntries.forEach(entry => {
        const key = entry.item;
        if(!shoppingList[key]) shoppingList[key] = { qtd: 0, un: entry.unidade };
        shoppingList[key].qtd += parseFloat(entry.quantidade);
    });

    let shopHtml = "<h4 style='margin-top:0'>Lista da Semana</h4><ul style='list-style:none; padding:0'>";
    for (const [nome, dados] of Object.entries(shoppingList)) {
        shopHtml += `
            <li style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border);">
               <span>${nome}</span>
               <span style="color:var(--primary)">${dados.qtd} ${dados.un}</span>
            </li>
        `;
    }
    shopHtml += "</ul>";
    shoppingContainer.innerHTML = shopHtml;
  }

  // --- NAVEGA√á√ÉO ---
  window.switchMainTab = function(tabName) {
     // Botoes
     document.querySelectorAll('.tab-nav button').forEach(b => b.classList.remove('active'));
     event.target.classList.add('active'); // O bot√£o clicado
     
     // Views
     document.getElementById('view-treino').classList.add('hidden');
     document.getElementById('view-dieta').classList.add('hidden');
     
     document.getElementById(`view-${tabName}`).classList.remove('hidden');
  }

  window.switchSubTab = function(context, subName) {
      // Contexto: treino ou dieta
      if(context === 'treino') {
          const btns = document.querySelectorAll('#view-treino .tab-nav button');
          btns.forEach(b => b.classList.remove('active'));
          event.target.classList.add('active');
          
          document.getElementById('tab-dia').classList.add('hidden');
          document.getElementById('tab-cardio').classList.add('hidden');
          document.getElementById(`tab-${subName}`).classList.remove('hidden');
      } else {
           const btns = document.querySelectorAll('#view-dieta .tab-nav button');
          btns.forEach(b => b.classList.remove('active'));
          event.target.classList.add('active');
          
          document.getElementById('diet-menu').classList.add('hidden');
          document.getElementById('diet-shopping').classList.add('hidden');
          
          if(subName === 'menu') document.getElementById('diet-menu').classList.remove('hidden');
          else document.getElementById('diet-shopping').classList.remove('hidden');
      }
  }
  
  // --- UPLOAD CSV HANDLER (LEGACY SUPPORT) ---
  document.getElementById('csvInput').addEventListener('change', function(e) {
     const file = e.target.files[0];
     if(!file) return;
     const reader = new FileReader();
     reader.onload = function(ev) {
        const text = ev.target.result;
        // Parser simples de CSV para JSON
        const lines = text.split('\n');
        const headers = lines[0].split(';').map(h => h.trim()); // Assume ponto e virgula
        
        // Se a primeira linha n√£o tiver headers esperados, tente virgula
        // (Simplifica√ß√£o: vamos assumir que o usu√°rio manteve o padr√£o)
        
        const newExercises = [];
        for(let i=1; i<lines.length; i++) {
           const row = lines[i].split(';');
           if(row.length < 3) continue;
           
           // Mapeia colunas do CSV antigo para o novo Obj
           // CSV: Dia;Grupo;Exerc√≠cio;Tipo;S√©ries;Reps/Tempo;RPE/Zona
           newExercises.push({
               dia: row[0],
               grupo: row[1],
               exercicio: row[2],
               tipo: row[3],
               series: row[4],
               repsTempo: row[5],
               rpeZona: row[6]
           });
        }
        
        baseExercises = newExercises;
        rebuildDiaOptions();
        renderDia();
        alert("Treino importado com sucesso! (Isso substitui o padr√£o temporariamente)");
     };
     reader.readAsText(file);
  });

  // Export JSON
  window.exportJson = function() {
    const dataStr = JSON.stringify(dailyLog, null, 2);
    const blob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "treino_backup.json";
    a.click();
  }
  
  window.resetDia = function() {
      if(!confirm("Tem certeza que quer apagar tudo de hoje?")) return;
      const diaSel = document.getElementById("dataInput").value;
      
      // Filtra chaves que cont√™m a data
      Object.keys(dailyLog).forEach(k => {
          if(k.includes(diaSel)) delete dailyLog[k];
      });
      saveLog();
      renderDia();
  }

  // --- EVENTOS GLOBAIS ---
  document.getElementById("diaSelect").addEventListener("change", () => { renderApp(); });
  document.getElementById("dataInput").addEventListener("change", () => { renderApp(); });

  // INICIALIZA
  document.addEventListener("DOMContentLoaded", initData);

</script>
</body>
</html>
